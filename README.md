# red__gimbal
23电赛E题
好多人问我用的啥舵机，用的啥模块，思路是啥，这里详细说一下。
因为云台位置和屏幕位置是固定的，所以可以算出屏幕上的x，y点对应的云台角度，所以用270度的舵机，可以计算出每个角度的pwm占空比，只要提前测量出云台水平角和云台与屏幕原点角度就行了。主控用的stm32f103c8t6，视觉使用openmv。
详细分析如下。
对于红色激光云台和屏幕，以画布原点建立直角坐标系，以云台建立欧拉角坐标系，已知云台与屏幕距离L=1m，云台与屏幕偏航角yaw0=0°，云台水平俯仰角pitch0，云台与屏幕原点俯仰角pitch1，由数学分析有。

$$
yaw = atan2(x/L)
$$

$$
pitch = atan2(tan(((pitch1-pitch0)*L+y)/L)
$$

于是我们便可以将屏幕上的x，y位置转换为云台的pitch和yaw。

对于屏幕和相机，已知屏幕原点和相机原点差值Δx，Δy，旋转角θ0，于是由平面坐标系转换有

$$
P_屏=R(P_相-\left[
 \begin{matrix}
   Δx\\
   Δy \\
  \end{matrix}
  \right])
$$

其中R为旋转矩阵

$$
R=\left[
 \begin{matrix}
   cos(θ_0) & -sin(θ_0)\\
   sin(θ_0) & cos(θ_0) \\
  \end{matrix}
  \right]
$$

于是我们便可以将相机上的x，y位置转换为屏幕上的x，y位置。

代码很乱，能实现基本任务前三题，并没有用到pid，只是用了步进式pid的算法做速度限制。
